# 读写分离

读写分离是将操作的sql分为查询操作与写操作，写操作(包括修改与删除)会操作主库，而查询操作则查询从库，从而提升数据库的效率，
另一方面，因为使用了读写分离，所以数据库锁记录的情况可以减少非常多，从而优化数据库性能及速度。

::: tip 提示
bigsql并不会实现主从复制，这一部分需要配置mysql的二进制日志自行实现，bigsql只是作为读写分离的应用场景
:::

::: tip 提示
bigsql中的读写分离是以数据库为单位的，也就是说bigsql中的逻辑库和物理库是一一对应的，但是数据库名可以不一样。
不支持配置单个表作为读写分离操作
:::

## 强制读主库

在任何应用产品的主从复制中，数据从主库同步到从库时，都是需要时间的，哪怕是毫秒级别的同步，这个一般会受制于当前的网络环境。如果在插入一条数据后，立即去查询这条数据，
因为插入的是主库，而查询的是从库，在查询的时候，有可能数据还没有同步到从库。

所以bigsql提供了一种强行读取主库的操作，也就是把一条查询语句，不读从库，强制读主库，避免这样的查询会查找不到数据的情况。
代码示例如下:

```sql
SELECT MASTER * FROM table_name
```

我们可以看到不同的地方是这条语句多了一个``MASTER``关键字，当bigsql检测到这个关键字时，就会把这条语句强行在主库执行，关键字不区分大小写。


## 配置读写分离

### 配置数据源

我们需要在bigsql的数据源目录建立相应的数据源，分别是主库的数据源和从库的数据源。[查看建立方式](/guide/config_datasource.md)


## 配置读写分离
我们[建立一个逻辑库](/guide/create_logic_database.md)，并且不添加任何表配置。前面也提到读写分离的逻辑库与物理库是一一对应的，所以我们新建的这个逻辑库只能是读写分离库，而**不能添加逻辑表配置**。

然后在逻辑库目录建立一个``default.xml``文件，文件配置如下:

```xml
<!-- 开头就是一个default标签，但是有一个type属性，标志这是配置一个主从库 -->
<default type="masterSlave">


    <!-- 对当前数据库应用的策略，这是一个全类名 -->
    <strategy>SimpleMasterSlaveStrategy</strategy>

    <!-- 此标签代表主从配置 -->
    <masterSlave>
        <!-- 这里配置的是属性列表 -->
        <properties>

            <!-- 主库的配置 -->
            <property>
                <key>master</key>
                <!-- 主库的数据源名称 -->
                <value>idc49</value>
            </property>

            <!-- 从库的配置 -->
            <property>
                <key>slave</key>
                <!-- 从库的数据源名称 -->
                <value>idc44</value>
            </property>

        </properties>

    </masterSlave>
</default>
```

如上就配置完成了，重新加载bigsql即可。
